<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="io.github.talelin.latticy.mapper.MedicinalStockMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="io.github.talelin.latticy.model.MedicinalInStockDO">
        <id column="id" property="id" />
        <result column="create_time" property="createTime" />
        <result column="update_time" property="updateTime" />
        <result column="created_by" property="createdBy" />
        <result column="last_updated_by" property="lastUpdatedBy" />
        <result column="fun_medi_id" property="medicinalName" />
        <result column="approve_batch_id" property="medicinalName" />
        <result column="factory" property="medicinalName" />
        <result column="stock_num" property="medicinalName" />
        <result column="price" property="medicinalName" />
        <result column="produce_date" property="pinyinma" />
        <result column="invalid_dade" property="spec" />
        <result column="medicinal_store_id" property="unit" />
        <result column="description" property="description" />
    </resultMap>
   <select id="getStockMedicinals" parameterType="java.lang.Integer" resultType="java.lang.Integer">
       select stock_num from fun_medicinal_stock ms where ms.fun_medi_id = #{fun_medi_id,jdbcType=INTEGER}
   </select>
    <update id="updateMedicinalStocks" parameterType="java.util.Map">
        update fun_medicinal_stock set stock_num = stock_num + #{stock_num,jdbcType=INTEGER}
        where fun_medi_id = #{fun_medi_id,jdbcType=INTEGER}
    </update>
    <insert id="initMedicinalStock" parameterType="java.util.Map">
        insert into fun_medicinal_stock(fun_medi_id,
                                        batch_id,
                                        approve_batch_id,
                                        factory,
                                        stock_num,
                                        price,
                                        produce_date,
                                        invalid_date,
                                        medicinal_store_id,
                                        description)values(
                                       #{fun_medi_id,jdbcType=INTEGER},
                                       #{batch_id,jdbcType=INTEGER},
                                       #{approve_batch_id,jdbcType=INTEGER},
                                       #{factory,jdbcType=VARCHAR},
                                       #{stock_num,jdbcType=INTEGER},
                                       #{price,jdbcType=INTEGER},
                                       date_format(#{produce_date,jdbcType=VARCHAR},'%Y-%m-%d'),
                                       date_format(#{invalid_date,jdbcType=INTEGER},'%Y-%m-%d'),
                                       #{medicinal_store_id,jdbcType=INTEGER},
                                       #{description,jdbcType=VARCHAR}
                                      )
    </insert>
</mapper>
